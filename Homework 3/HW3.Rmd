---
title: 'Homework #3: Matching'
author: Eric Cheng, Julio Guzman, Vinh Luong, Jorge Ortega, Shao Zhu
output: pdf_document
fontsize: 12
geometry: margin=0.6in
---


# Load Data

```{r}
load("HW3df.rdat")

summary(df)
```


# Some Simple Plots

Distribution of the looks of Women senders:

```{r}
barplot(
  table(df[df$SenderGender==1, ]$SenderLooks))
```

Distribution of the looks of Men senders:

```{r}
barplot(
  table(df[df$SenderGender==2, ]$SenderLooks))
```


# Models to Predict Probability of Sending a Message

For Men and Women, we run separate Logit models to capture the impact looks of the receiver have on the probability of sending a message:

```{r}
lres.m = glm(y~ReceiverLooks,data=df[df$SenderGender==2, ], family='binomial')
summary(lres.m)
```

```{r}
lres.f = glm(y~ReceiverLooks,data=df[df$SenderGender==1, ], family='binomial')
summary(lres.f)
```

Prediction functions from those models:

```{r}
pred.prob.male=function(Xfemale){
  predict(
    lres.m,
    newdata=data.frame(ReceiverLooks=factor(Xfemale,levels=1:11)),
    type='response')
}

pred.prob.female=function(Xmale){
  predict(
    lres.f,
    newdata=data.frame(ReceiverLooks=factor(Xmale,levels=1:11)),
    type='response')
}

# using these functions I can create a match score
# that simply multiplies the two predictions and takes a square root
pred.match = function(Xmale,Xfemale)
{
  as.numeric(sqrt(pred.prob.female(Xmale)*pred.prob.male(Xfemale)))
}
```


# Q1: What can you say about the preferences of sender men and women related to the looks of the receiver? Are there differences across the genders?

For both men and women, it appears that the better looking the receivers are, the higher the probability for the senders to make an initial move. This positive correlation is more profound among males than females, indicating that men generally value appearances more.  Men are much more likely to message a good looking receiver whereas women are only slightly more likely to message a good looking receiver.

```{r}
# We can plot the probabilities for Male Senders
plot(x=1:11,y=pred.prob.male(1:11),type='b',pch=19,col="steelblue",xlab="Receiver Looks",ylab="Predicted Probability", main="Probability of Messaging Based on Receiver Looks")
# and over Women Senders
lines(x=1:11,y=pred.prob.female(1:11),type='b',pch=19,col='darkred')
legend(2, .16, c("Men", "Women"), lty=c(1,1),col=c("steelblue","darkred"))
```

# Q2: Does the utility/preference function change depending on the looks of the Sender? Are there differences in how these changes for men and women?

Yes, as shown in the previous graph, the utility/preference function changes depending on the looks of the sender and there are differences between men and women.  

First, for both male and female, it seems that that the less good looking the senders, the more likely they are to send a message. However, this effect is more profound amongst the female senders.  Also, for both genders, the less good looking individuals are less likely to initiate a contact with the most good looking (i.e. looks that are rated as 8 or above).  


```{r}
#     For Males
#     This code estimates preferences for Sender Males with Looks rated less than 6
      lres.m5 = glm(y~ReceiverLooks,data=df[df$SenderGender==2 & as.numeric(df$SenderLooks)<6,],family='binomial')
#     We can then create a prediction function
pred.prob.m5=function(Xfemale){
      predict(lres.m5,newdata=data.frame(ReceiverLooks=factor(Xfemale,levels=1:11)),type='response')
}

      lres.m3 = glm(y~ReceiverLooks,data=df[df$SenderGender==2 & as.numeric(df$SenderLooks)<4,],family='binomial')
#     We can then create a prediction function
      pred.prob.m3=function(Xfemale){
        predict(lres.m3,newdata=data.frame(ReceiverLooks=factor(Xfemale,levels=1:11)),type='response')
      }
#     And compare to the full sample
#     All Sender=Male 
      plot(x=1:11,y=pred.prob.male(1:11),type='b',pch=19,col="steelblue",xlab="Receiver Looks",ylab="Predicted Probability", main="Male Senders Likelihood of Sending a Message")
#     for Looks < 6 
      lines(x=1:11,y=pred.prob.m5(1:11),type='b',pch=19,col='darkgreen',lty=2)
      lines(x=1:11,y=pred.prob.m3(1:11),type='b',pch=19,col='red',lty=2)
      legend(2,.16, c("All", "Men Rated 5 or less","Men Rated 3 or less"), lty=c(2,2,2), col=c("steelblue", "darkgreen", "red"))
```

Second, as shown in the graph above, male senders with looks rated 5 or less are less likely to send a message to females (receiver) that have looks rated above 9 (9,10,11). This happens for Men rated 5 or less, and for men rated 3 or less as well. It is interesting to notice that Men rated "3 or less"" are less likely to send a message to women rated above 9 than men rated "5 or less". The curious finding is that these two groups have a similar probability of sending a message to women with looks rated below or equal to 8. 


```{r}
#     For Females
#     This code estimates preferences for Sender Females with Looks rated less than 6
      lres.f5 = glm(y~ReceiverLooks,data=df[df$SenderGender==1 & as.numeric(df$SenderLooks)<6,],family='binomial')
#     We can then create a prediction function
      pred.prob.f5=function(Xmale){
        predict(lres.f5,newdata=data.frame(ReceiverLooks=factor(Xmale,levels=1:11)),type='response')
      }
      
      lres.f3 = glm(y~ReceiverLooks,data=df[df$SenderGender==1 & as.numeric(df$SenderLooks)<4,],family='binomial')
#     We can then create a prediction function
      pred.prob.f3=function(Xmale){
        predict(lres.f3,newdata=data.frame(ReceiverLooks=factor(Xmale,levels=1:11)),type='response')
      }
#     And compare to the full sample
#     All Sender=Female
      plot(x=1:11,y=pred.prob.female(1:11),type='b',pch=19,col="steelblue",xlab="Receiver Looks",ylab="Predicted Probability", main="Female Senders Likelihood of Sending a Message")
#     for Looks < 6 
      lines(x=1:11,y=pred.prob.f5(1:11),type='b',pch=19,col='darkgreen',lty=2)
      lines(x=1:11,y=pred.prob.f3(1:11),type='b',pch=19,col='red',lty=2)
      legend(2,.11, c("All", "Women Rated 5 or less","Women Rated 3 or less"), lty=2, col=c("steelblue", "darkgreen", "red"))
```

Third, as shown in the figure above, the lower the looks are rated for women (sender), the more likely are them to send a message to men (receiver) with looks rated below 9. This finding is totally different to men senders with lower rated looks, who behave similar to the whole sample for women (receiver) looks rated below 9 (shown previously). 
Specifically, women rated 3 or less (red line) are more likely to send messages overall compared to the whole sample. The same happens for women rated 5 or less (green line), but with a slightly lower magnitude.


# Review if there any conclusion to be included. 
```{r}

# Other levels
max.level <- 3

#     This code estimates preferences for Sender Males with Looks rated less than 6
lres.m5 = glm(y~ReceiverLooks,data=df[df$SenderGender==2 & as.numeric(df$SenderLooks)<max.level,],family='binomial')
#     We can then create a prediction function
pred.prob.m5=function(Xfemale){
  predict(lres.m5,newdata=data.frame(ReceiverLooks=factor(Xfemale,levels=1:11)),type='response')
}
#     And compare to the full sample
#     All Sender=Male 
plot(x=1:11,y=pred.prob.male(1:11),type='b',pch=19,col="steelblue",xlab="Receiver Looks",ylab="Predicted Probability")
#     for Looks < 6 
lines(x=1:11,y=pred.prob.m5(1:11),type='b',pch=19,col='blue',lty=2)
#
#
#     You can use these ideas to explore various levels of sender looks.
#     Of course you can do this for women senders as well...

#     This code estimates preferences for Sender Males with Looks rated less than 6
lres.f5 = glm(y~ReceiverLooks,data=df[df$SenderGender==1 & as.numeric(df$SenderLooks)<max.level,],family='binomial')
#     We can then create a prediction function
pred.prob.f5=function(Xmale){
  predict(lres.f5,newdata=data.frame(ReceiverLooks=factor(Xmale,levels=1:11)),type='response')
}
#     And compare to the full sample
#     All Sender=Male 
plot(x=1:11,y=pred.prob.female(1:11),type='b',pch=19,col="steelblue",xlab="Receiver Looks",ylab="Predicted Probability")
#     for Looks < 6 
lines(x=1:11,y=pred.prob.f5(1:11),type='b',pch=19,col='blue',lty=2)


# If max.level = 3 Males don't show a significant change in pattern (slighly increase
# in the change of sending a message ofr lower receiver looks). Nonetheless, for females
# the probaility of sending a message increases at all levels.

# What's the behavior of the Male sender = 11 and the Woman Sender = 11?
true.level <- 8

#     This code estimates preferences for Sender Males with Looks rated as true.level
lres.m5 = glm(y~ReceiverLooks,data=df[df$SenderGender==2 & as.numeric(df$SenderLooks)==true.level,],family='binomial')
#     We can then create a prediction function
pred.prob.m5=function(Xfemale){
  predict(lres.m5,newdata=data.frame(ReceiverLooks=factor(Xfemale,levels=1:11)),type='response')
}
#     And compare to the full sample
#     All Sender=Male 
plot(x=1:11,y=pred.prob.male(1:11),type='b',pch=19,col="steelblue",xlab="Receiver Looks",ylab="Predicted Probability", ylim=c(0.03, 0.25))
#     for Looks < 6 
lines(x=1:11,y=pred.prob.m5(1:11),type='b',pch=19,col='blue',lty=2)
#
#
#     You can use these ideas to explore various levels of sender looks.
#     Of course you can do this for women senders as well...

#     This code estimates preferences for Sender Males with Looks rated as true.level
lres.f5 = glm(y~ReceiverLooks,data=df[df$SenderGender==1 & as.numeric(df$SenderLooks)==true.level,],family='binomial')
#     We can then create a prediction function
pred.prob.f5=function(Xmale){
  predict(lres.f5,newdata=data.frame(ReceiverLooks=factor(Xmale,levels=1:11)),type='response')
}
#     And compare to the full sample
#     All Sender=Male 
plot(x=1:11,y=pred.prob.female(1:11),type='b',pch=19,col="steelblue",xlab="Receiver Looks",ylab="Predicted Probability", ylim=c(0, 0.15))
#     for Looks < 6 
lines(x=1:11,y=pred.prob.f5(1:11),type='b',pch=19,col='blue',lty=2)

# As shown, males with looks of 11 are less likely to send a message to people under 10, but
# much likely to send a message to females with 10 or 11, maybe because of more confidence
# On the other hand, women with looks of 11, are much less likely to send a message to males
# than the average except for males with rating of 10.

# Other interesting findings: Women level 8 behave like males. Males level 8 send more messages than average.


```


# Q3: Using the pred.match function explore the match scores between men and women at various looks percentiles. Comment on and explain your findings. For example, you may want to explore why pred.match(2,10) differs from pred.match(10,2).    

Generally speaking, regardless of the genders, the better looking the receivers are, the higher the matching scores. However, it seems that the male cares about look more than female. For High ratings of Looks of any sender it seems that this spread tightens, meaning that good looking women value looks similarly to good looking man.

```{r}

pred.match = function(Xmale,Xfemale)
{
  as.numeric(sqrt(pred.prob.female(Xmale)*pred.prob.male(Xfemale)))
}

A = matrix (nrow=11,ncol=11, byrow=TRUE)
for (i in 1:11){
  for (j in 1:11){
  A[i,j]=pred.match(i,j)
  }
}

par(mfrow=c(2,2))
for(i in 1:4){
  plot(A[i,1:11],xlab='Receiver Looks', ylab='Match Score',col='blue',type='l', main=i)
  lines(A[1:11,i],col='red', type='l')
}

par(mfrow=c(2,2))
for(i in 5:8){
  plot(A[i,1:11],xlab='Receiver Looks', ylab='Match Score',col='blue',type='l',main=i)
  lines(A[1:11,i],col='red', type='l')
}

par(mfrow=c(1,3))
for(i in 9:11){
  plot(A[i,1:11],xlab='Receiver Looks', ylab='Match Score',col='blue',type='l',main=i)
  lines(A[1:11,i],col='red', type='l')
}

```



# Q4: (Optional: Warning Difficult and Time Consuming!) How would you change the match function to account for the findings in Q2. How do the results compare to the original pred.match function results.
